cmake_minimum_required(VERSION 3.10)
project(Lab1C)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Основная программа
add_executable(lab1 lab1.cpp)

# Тестовые данные
configure_file(input.txt input.txt COPYONLY)

# Добавляем тест
enable_testing()

add_test(NAME Lab1_Test
    COMMAND lab1
    WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
)

# Проверка выходных данных
set(TEST_EXPECTED_OUTPUT "Average value: 5.4\nElement closest to average: 5.1\nDifference: 0.3")add_test(NAME Lab1_Output_Validation
    COMMAND ${CMAKE_COMMAND} -DTEST_COMMAND=$<TARGET_FILE:lab1> -DEXPECTED_OUTPUT="${TEST_EXPECTED_OUTPUT}" -P ${CMAKE_SOURCE_DIR}/test_validation.cmake
    WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
)
